webpackJsonp([21],{"1cS7":function(e,t,a){var s=a("WxTz");"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);a("rjj0")("7d620595",s,!0)},WxTz:function(e,t,a){t=e.exports=a("FZ+f")(!1),t.push([e.i,"\n.add-h4[data-v-82c690ca]{padding-left:10px;margin-left:20px;border-left:5px solid #3c8dbc\n}\n.add-icon[data-v-82c690ca]{font-weight:600;color:#3c8dbc\n}\n.upload_box[data-v-82c690ca] .el-upload{width:150px;height:150px;border-radius:2px;border:1px solid #9e9da2;text-align:center;line-height:150px\n}\n.upload_box[data-v-82c690ca] .el-upload-dragger{width:148px;height:148px;border:0\n}\n.set-pop[data-v-82c690ca] .el-input__inner{border-color:#bbb\n}\n.set-pop[data-v-82c690ca] .el-form-item__content{text-align:center\n}\n.set-pop[data-v-82c690ca] .el-range-editor.el-input__inner{width:100%\n}\n.set-pop[data-v-82c690ca] .el-input,.set-pop[data-v-82c690ca] .el-select,.set-pop[data-v-82c690ca] .el-switch{width:100%\n}\n.set-pop[data-v-82c690ca] .el-select>.el-input{width:100%\n}\n.set-pop[data-v-82c690ca] .el-radio-group{width:100%\n}\n.set-pop[data-v-82c690ca] .el-dialog__footer{text-align:center\n}\n.set-pop[data-v-82c690ca] .el-cascader{width:100%\n}\n.set-pop[data-v-82c690ca] .el-cascader .el-input{width:100%\n}\n.avatar-uploader .el-upload[data-v-82c690ca]{border:1px dashed #d9d9d9;border-radius:6px;cursor:pointer;position:relative;overflow:hidden\n}\n.avatar-uploader .el-upload[data-v-82c690ca]:hover{border-color:#409EFF\n}\n.avatar-uploader-icon[data-v-82c690ca]{font-size:28px;color:#8c939d;width:148px;height:148px;line-height:148px;text-align:center;border:1px dashed #c0ccda\n}\n.avatar[data-v-82c690ca]{width:148px;height:148px;display:block\n}\n",""])},gJyo:function(e,t,a){"use strict";function s(e){a("1cS7")}Object.defineProperty(t,"__esModule",{value:!0});var o=a("mvHQ"),i=a.n(o),l=(a("XLwt"),{name:"home",data:function(){return{msg:"项目管理",addPersonForm:{appId:"",faceUrl:"",houseList:[],icNum:"",id:"",idNum:"",personName:"",phone:"",remark:""},rules:{personName:[{required:!0,message:"请输入住户姓名",trigger:"blur"}],phone:[{validator:function(e,t,a){t?/^1(3|4|5|6|7|8|9)\d{9}$/.test(t)?a():a(new Error("请输入正确的手机号")):a(new Error("请输入手机号"))},trigger:"blur"}]},imageUrl:"",addPop:!0,groupName:"",startTime:null,options:[{value:"zhinan",label:"指南",children:[]}],value:!0,data:[],defaultProps:{children:"children",label:"label"},tableData:[],addPopVisible:!1,uploadData:{appId:""},images:[],imgurl:"",cascaderData:[],groupProps:{children:"groups",label:"name",value:"id",expandTrigger:"hover"},addHouseForm:{effectiveTimeStr:"",liveStatus:1,personSubtype:"",deviceGroupId:"",type:1},popRules:{effectiveTimeStr:[{required:!0,message:"请选择有效期",trigger:"change"}],personSubtype:[{required:!0,message:"请选择住户身份",trigger:"change"}],deviceGroupId:[{required:!0,message:"请选择房屋",trigger:"change"}]},pickerOptions:{disabledDate:function(e){return e.getTime()<=Date.now()-864e5},shortcuts:[{text:"一个月",onClick:function(e){var t=new Date;t.setTime(t.getTime()+2592e6),e.$emit("pick",t)}},{text:"半年",onClick:function(e){var t=new Date;t.setTime(t.getTime()+158112e5),e.$emit("pick",t)}},{text:"一年",onClick:function(e){var t=new Date;t.setTime(t.getTime()+31536e6),e.$emit("pick",t)}},{text:"永久",onClick:function(e){var t=new Date,a=t.getMonth()+1,s=t.getDate();a<10&&(a="0"+a),s<10&&(s="0"+s),e.$emit("pick","9999-"+a+"-"+s+" 00:00:00")}}]},personType:[{value:1,label:"户主"},{value:2,label:"家庭成员"},{value:3,label:"租客"},{value:5,label:"其他"}],isEdit:!0,currentIndex:0,deleteArr:[],editOrAdd:"添加",isRequst:!1}},computed:{appId:{get:function(){return this.$store.state.project.projectId},set:function(e){this.$store.commit("changeProjectId",e)}}},watch:{appId:function(e,t){this.appId=e,this.addPersonForm.appId=e,this.uploadData.appId=e,this.getLeftData()}},filters:{clTime:function(e){return e.split(" ")[0]}},created:function(){this.imgurl=this.tools.global.API_URL},mounted:function(){this.addPersonForm.appId=this.appId,this.uploadData.appId=this.appId,this.getLeftData(),2==this.$route.query.type&&(this.addPersonForm=JSON.parse(this.utils.getStore("ownerMsg")),this.editOrAdd="更新",this.addPersonForm.faceUrl&&(this.images=this.addPersonForm.faceUrl.split(",")))},methods:{beforeAvatarUpload:function(e){var t=["image/jpeg","image/jpg","image/png","image/bmp"],a=t.includes(e.type),s=e.size/1024/1024<5;return console.log(e.size),a?s?void 0:(this.$message.error("上传图片大小不能超过 5MB!"),!1):(this.$message.error("格式不支持"),!1)},successCheck:function(e,t,a){var s=this;console.log(e),200==e.code?this.images.length<1?e.data.forEach(function(e,t){s.images.push(e)}):this.utils.tip("warning","文件个数超出"):this.utils.tip("warning",e.msg)},uploadErr:function(e,t,a){this.$message.error("上传失败")},remove:function(e){this.images.splice(e,1)},addPersonBtn:function(e){var t=this;console.log(this.addPersonForm),this.$refs[e].validate(function(e){e&&(t.isRequst=!0,t.addPersonForm.faceUrl=t.images.join(),t.addPersonForm.houseList=t.addPersonForm.houseList.concat(t.deleteArr),t.utils.http({url:"/person/saveHousehold",method:"POST",data:t.addPersonForm},function(e){t.isRequst=!1,console.log(e),"200"==e.code&&t.$router.push({path:"/ownermanage"})}))})},addPopPerson:function(e){var t=this;this.$refs[e].validate(function(e){e&&(t.isEdit?(t.addHouseForm.id&&(t.addHouseForm.type=2),t.addPersonForm.houseList[t.currentIndex]=t.addHouseForm,t.addPopVisible=!1):(t.addPersonForm.houseList?t.addPersonForm.houseList.push(t.addHouseForm):(t.addPersonForm.houseList=[],t.addPersonForm.houseList.push(t.addHouseForm)),t.addPopVisible=!1),t.addHouseForm={effectiveTimeStr:"",liveStatus:1,personSubtype:"",deviceGroupId:"",type:1})})},closePop:function(){var e=this;this.$nextTick(function(){e.$refs.addHouseForm.clearValidate()}),this.addHouseForm={effectiveTimeStr:"",liveStatus:1,personSubtype:"",deviceGroupId:"",type:1}},cascaderChange:function(e){this.addHouseForm.deviceGroupId=e[e.length-1];var t=this.$refs.cascaderAddr.getCheckedNodes()[0].pathLabels,a="";t.forEach(function(e){a+=e}),this.addHouseForm.houseAddress=a},getLeftData:function(){var e=this;this.cascaderData=[],this.utils.http({url:"/base/house/list",method:"GET",params:{appId:this.appId}},function(t){200==t.code&&t.data.groups&&(e.cascaderData=t.data.groups)})},addBtn:function(){this.isEdit=!1,this.addPopVisible=!0},gotoEdit:function(e){this.isEdit=!0,this.currentIndex=e,this.addHouseForm=JSON.parse(i()(this.addPersonForm.houseList[e])),console.log(this.addHouseForm),this.addPopVisible=!0},clickDel:function(e,t){var a=this;this.$confirm("您确信删除此房屋信息?","确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.id&&(t.type=3,a.deleteArr.push(t)),a.addPersonForm.houseList.splice(e,1)}).catch(function(){})},goBack:function(){this.$router.push({path:"/ownermanage"})},changeType:function(){},changeTime:function(e){console.log(e)},handleCheckedCitiesChange:function(e){console.log(e)}}}),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content-wrapper"},[e._m(0),e._v(" "),a("section",{staticClass:"content container-fluid"},[a("div",{staticClass:"panel-body",staticStyle:{padding:"0"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("div",{staticClass:"box box-primary"},[a("div",{staticClass:"box-header with-border"},[a("h3",{staticClass:"box-title"},[e._v(e._s(e.editOrAdd))])]),e._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-lg-6 col-md-12"},[a("h4",{staticClass:"add-h4"},[e._v("基础信息")]),e._v(" "),a("el-form",{ref:"addPersonForm",staticStyle:{"padding-bottom":"30px"},attrs:{model:e.addPersonForm,rules:e.rules}},[a("div",{staticClass:"row"},[a("label",{staticClass:"col-sm-3 control-label text-right",attrs:{for:"name"}},[a("span",{staticStyle:{color:"red","line-height":"40px"}},[e._v("*")]),e._v("\n                      住户姓名\n                    ")]),e._v(" "),a("div",{staticClass:"col-sm-7"},[a("el-form-item",{attrs:{prop:"personName"}},[a("el-input",{attrs:{placeholder:"输入住户姓名最大支持20字",maxlength:"20"},model:{value:e.addPersonForm.personName,callback:function(t){e.$set(e.addPersonForm,"personName",t)},expression:"addPersonForm.personName"}})],1)],1),e._v(" "),a("div",{staticClass:"col-sm-2",staticStyle:{"line-height":"34px",color:"red"}})]),e._v(" "),a("div",{staticClass:"row"},[a("label",{staticClass:"col-sm-3 control-label text-right",attrs:{for:"name"}},[a("span",{staticStyle:{color:"red","line-height":"40px"}},[e._v("*")]),e._v("\n                      手机号码\n                    ")]),e._v(" "),a("div",{staticClass:"col-sm-7"},[a("el-form-item",{attrs:{prop:"phone"}},[a("el-input",{attrs:{placeholder:"输入住户真实手机号，可登陆app远程开门",maxlength:"11"},model:{value:e.addPersonForm.phone,callback:function(t){e.$set(e.addPersonForm,"phone",t)},expression:"addPersonForm.phone"}})],1)],1),e._v(" "),a("div",{staticClass:"col-sm-2",staticStyle:{"line-height":"34px",color:"red"}})]),e._v(" "),a("div",{staticClass:"row"},[a("label",{staticClass:"col-sm-3 control-label text-right",attrs:{for:"name"}},[a("span",{staticStyle:{color:"red","line-height":"40px"}}),e._v("\n                      身份证号\n                    ")]),e._v(" "),a("div",{staticClass:"col-sm-7"},[a("el-form-item",{attrs:{prop:"idCard"}},[a("el-input",{attrs:{placeholder:"输入住户身份证号最大支持18字",maxlength:"18"},model:{value:e.addPersonForm.idNum,callback:function(t){e.$set(e.addPersonForm,"idNum",t)},expression:"addPersonForm.idNum"}})],1)],1),e._v(" "),a("div",{staticClass:"col-sm-2",staticStyle:{"line-height":"34px",color:"red"}})]),e._v(" "),a("div",{staticClass:"row"},[a("label",{staticClass:"col-sm-3 control-label text-right",attrs:{for:"name"}},[a("span",{staticStyle:{color:"red","line-height":"40px"}}),e._v("\n                      备 注\n                    ")]),e._v(" "),a("div",{staticClass:"col-sm-7"},[a("el-form-item",[a("el-input",{attrs:{type:"textarea",maxlength:"100","show-word-limit":"",rows:"5",placeholder:"请输入住户备注信息"},model:{value:e.addPersonForm.remark,callback:function(t){e.$set(e.addPersonForm,"remark",t)},expression:"addPersonForm.remark"}})],1)],1),e._v(" "),a("div",{staticClass:"col-sm-2",staticStyle:{"line-height":"34px",color:"red"}})]),e._v(" "),a("h4",{staticClass:"add-h4"},[e._v("通行凭证")]),e._v(" "),a("div",{staticClass:"row"},[a("label",{staticClass:"col-sm-3 control-label text-right",attrs:{for:"name"}},[a("span",{staticStyle:{color:"red","line-height":"40px"}}),e._v("\n                      人脸头像\n                    ")]),e._v(" "),a("div",{staticClass:"col-sm-7"},[a("div",{staticClass:"upload_box"},[0==e.images.length?a("el-upload",{attrs:{drag:"",name:"file","with-credentials":!0,"show-file-list":!1,action:e.imgurl+"/file/person/upload","list-type":"picture-card",data:e.uploadData,"on-success":e.successCheck,"before-upload":e.beforeAvatarUpload,"on-error":e.uploadErr}},[a("span",{staticStyle:{color:"#9E9DA2","font-size":"12px"}},[e._v("+添加图片")])]):a("ul",{staticClass:"el-upload-list el-upload-list--picture-card"},e._l(e.images,function(t,s){return a("li",{key:s,staticClass:"el-upload-list__item is-success animated",attrs:{tabindex:s}},[t?a("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:e.imgurl+"/file/download?path="+t,alt:""}}):e._e(),e._v(" "),a("a",{staticClass:"el-upload-list__item-name"},[a("i",{staticClass:"el-icon-document"}),e._v("\n                              "+e._s(t.name)+"\n                            ")]),e._v(" "),a("label",{staticClass:"el-upload-list__item-status-label"},[a("i",{staticClass:"el-icon-upload-success el-icon-check"})]),e._v(" "),a("span",{staticClass:"el-upload-list__item-actions"},[a("span",{staticClass:"el-upload-list__item-delete"},[a("i",{staticClass:"el-icon-delete",on:{click:function(t){e.remove(s)}}})])])])}))],1)])]),e._v(" "),a("div",{staticClass:"row mt-20"},[a("label",{staticClass:"col-sm-3 control-label text-right",attrs:{for:"name"}},[a("span",{staticStyle:{color:"red","line-height":"40px"}}),e._v("\n                      IC卡片\n                    ")]),e._v(" "),a("div",{staticClass:"col-sm-7"},[a("el-form-item",{attrs:{prop:"post"}},[a("el-input",{attrs:{placeholder:"输入IC卡号"},model:{value:e.addPersonForm.icNum,callback:function(t){e.$set(e.addPersonForm,"icNum",t)},expression:"addPersonForm.icNum"}})],1)],1),e._v(" "),a("div",{staticClass:"col-sm-2",staticStyle:{"line-height":"34px",color:"red"}})])])],1),e._v(" "),a("div",{staticClass:"col-lg-6 col-md-12"},[a("h4",{staticClass:"add-h4"},[e._v("\n                  房屋信息\n                  "),a("span",{staticClass:"el-icon-plus ml-20 add-icon",on:{click:e.addBtn}})]),e._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-sm-11",staticStyle:{"overflow-x":"hidden","overflow-y":"auto"}},[a("el-table",{ref:"multipleTable",staticClass:"mt-10",staticStyle:{width:"100%"},attrs:{data:e.addPersonForm.houseList,border:!0,"cell-style":{background:"#fff",fontSize:"14px",color:"#12111D",padding:"6px 0"},stripe:!0,"default-sort":{prop:"date",order:"descending"}}},[a("el-table-column",{attrs:{prop:"personSubtype",label:"类型",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.personSubtype?a("span",[e._v("户主")]):e._e(),e._v(" "),2==t.row.personSubtype?a("span",[e._v("家庭成员")]):e._e(),e._v(" "),3==t.row.personSubtype?a("span",[e._v("租客")]):e._e(),e._v(" "),5==t.row.personSubtype?a("span",[e._v("其他")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"houseAddress",label:"房屋信息",sortable:"",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"effectiveTimeStr",label:"有效期",sortable:"",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.effectiveTimeStr?a("span",[e._v(e._s(e._f("clTime")(t.row.effectiveTimeStr)))]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"liveStatus",label:"状态",sortable:"",width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.liveStatus?a("span",[e._v("入住")]):e._e(),e._v(" "),0==t.row.liveStatus?a("span",[e._v("搬离")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-row",[a("el-button",{attrs:{title:"编辑",type:"primary",icon:"el-icon-edit",round:"",size:"mini"},on:{click:function(a){e.gotoEdit(t.$index)}}}),e._v(" "),a("el-button",{attrs:{title:"取消",type:"danger",icon:"el-icon-delete",round:"",size:"mini"},on:{click:function(a){e.clickDel(t.$index,t.row)}}})],1)]}}])})],1)],1)]),e._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"form-group col-sm-11 mt-40"},[e.isRequst?a("button",{staticClass:"btn btn-primary",attrs:{type:"submit"}},[e._v("保存中")]):a("button",{staticClass:"btn btn-primary",attrs:{type:"submit"},on:{click:function(t){e.addPersonBtn("addPersonForm")}}},[e._v("保存")]),e._v(" "),a("button",{staticClass:"btn btn-default",attrs:{type:"button",id:"btn-back"},on:{click:e.goBack}},[e._v("返回")])])])])])])])])])]),e._v(" "),a("el-dialog",{staticClass:"el-dialog-reset set-pop",attrs:{title:"添加房屋",visible:e.addPopVisible,width:"40%","close-on-click-modal":!1},on:{"update:visible":function(t){e.addPopVisible=t},close:e.closePop}},[a("div",{staticStyle:{padding:"0px"}},[a("el-form",{ref:"addHouseForm",attrs:{model:e.addHouseForm,rules:e.popRules}},[a("div",{staticClass:"row"},[a("label",{staticClass:"col-sm-3 control-label text-right",attrs:{for:"name"}},[a("span",{staticStyle:{color:"red","line-height":"40px"}},[e._v("*")]),e._v("\n            房屋信息\n          ")]),e._v(" "),a("div",{staticClass:"col-sm-6"},[a("el-form-item",{attrs:{prop:"deviceGroupId"}},[a("el-cascader",{ref:"cascaderAddr",attrs:{placeholder:"楼栋/单元/房间",options:e.cascaderData,props:e.groupProps},on:{change:e.cascaderChange},model:{value:e.addHouseForm.deviceGroupId,callback:function(t){e.$set(e.addHouseForm,"deviceGroupId",t)},expression:"addHouseForm.deviceGroupId"}})],1)],1)]),e._v(" "),a("div",{staticClass:"row"},[a("label",{staticClass:"col-sm-3 control-label text-right",attrs:{for:"name"}},[a("span",{staticStyle:{color:"red","line-height":"40px"}},[e._v("*")]),e._v("\n            住户身份\n          ")]),e._v(" "),a("div",{staticClass:"col-sm-6"},[a("el-form-item",{attrs:{prop:"personSubtype"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.addHouseForm.personSubtype,callback:function(t){e.$set(e.addHouseForm,"personSubtype",t)},expression:"addHouseForm.personSubtype"}},e._l(e.personType,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1)]),e._v(" "),a("div",{staticClass:"row"},[a("label",{staticClass:"col-sm-3 control-label text-right",attrs:{for:"name"}},[a("span",{staticStyle:{color:"red","line-height":"40px"}},[e._v("*")]),e._v("\n            有效日期\n          ")]),e._v(" "),a("div",{staticClass:"col-sm-6"},[a("el-form-item",{attrs:{prop:"effectiveTimeStr"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"有效日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},on:{change:e.changeTime},model:{value:e.addHouseForm.effectiveTimeStr,callback:function(t){e.$set(e.addHouseForm,"effectiveTimeStr",t)},expression:"addHouseForm.effectiveTimeStr"}})],1)],1)]),e._v(" "),a("div",{staticClass:"row"},[a("label",{staticClass:"col-sm-3 control-label text-right",attrs:{for:"name"}},[a("span",{staticStyle:{color:"red","line-height":"40px"}},[e._v("*")]),e._v("\n            住户状态\n          ")]),e._v(" "),a("div",{staticClass:"col-sm-6"},[a("el-form-item",[a("el-radio-group",{model:{value:e.addHouseForm.liveStatus,callback:function(t){e.$set(e.addHouseForm,"liveStatus",t)},expression:"addHouseForm.liveStatus"}},[a("el-radio",{attrs:{label:1}},[e._v("入住")]),e._v(" "),a("el-radio",{attrs:{label:0}},[e._v("搬离")])],1)],1)],1)])])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.addPopVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addPopPerson("addHouseForm")}}},[e._v("确 定")])],1)])],1)},n=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"content-header"},[a("h1",{staticClass:"nice"},[e._v("\n      人员管理 - 添加住户\n      ")]),e._v(" "),a("ol",{staticClass:"breadcrumb"},[a("li",[a("a",{attrs:{href:"/"}},[a("i",{staticClass:"glyphicon glyphicon-home"}),e._v(" 首页\n        ")])]),e._v(" "),a("li",[a("i",{staticClass:"glyphicon glyphicon-user"}),e._v(" 人员管理\n      ")]),e._v(" "),a("li",{staticClass:"active"},[a("i",{staticClass:"glyphicon glyphicon-adjust"}),e._v(" 添加住户\n      ")])])])}],d={render:r,staticRenderFns:n},c=d,p=a("VU/8"),u=s,m=p(l,c,!1,u,"data-v-82c690ca",null);t.default=m.exports}});